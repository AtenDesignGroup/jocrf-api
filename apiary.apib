FORMAT: 1A
HOST: http://polls.apiblueprint.org/

# jocrf

API Endpoints and resources for JOCRF dashboard app.

# Group Login

## OAUTH Token [/oauth/token]

### Get access token [POST]

+ Attributes
    + grant_type - "password
    + client_id - "29ccd144-0752-4fee-99bc-48aa3f87a680"
    + client_secret (string) - Secret set in OAauth settings
    + username (string) - Drupal user's username
    + password (string) - Drupal user's password
    + scope (string) - Role names separated by spaces

+ Request (application/x-www-form-urlencoded)

    + Body

            {
                "grant_type": "password",
                "client_id": "29ccd144-0752-4fee-99bc-48aa3f87a680",
                "client_secret": "qu[G9duTBKna",
                "username": "testuser",
                "password": "12345",
                "scope": "ta"
            }

+ Response 200 (application/json)

        {
            "token_type": "Bearer",
            "expires_in": 300,
            "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjNkZTAxZDVhNmI1NjgxMDcxMzgxODNhNWFjYmMyZTQwMzgyOTRhZTQxNGMxNDUwMzE3MTAxZjI0YTJhZGE4MWYxMTUzODIxZTJhOTdiYjEzIn0.eyJhdWQiOiIyOWNjZDE0NC0wNzUyLTRmZWUtOTliYy00OGFhM2Y4N2E2ODAiLCJqdGkiOiIzZGUwMWQ1YTZiNTY4MTA3MTM4MTgzYTVhY2JjMmU0MDM4Mjk0YWU0MTRjMTQ1MDMxNzEwMWYyNGEyYWRhODFmMTE1MzgyMWUyYTk3YmIxMyIsImlhdCI6MTU0MDgzNTE2NSwibmJmIjoxNTQwODM1MTY1LCJleHAiOjE1NDA4MzU0NjUsInN1YiI6IjUxIiwic2NvcGVzIjpbImF1dGhlbnRpY2F0ZWQiLCJhY2NvdW50YW50IiwiY2xpZW50IiwiZGlyZWN0b3IiLCJyZXNlYXJjaGVyIiwidGEiLCJ0ZW1wb3JhcnlfY2xpZW50Il19.Um33uF0As0tMDHFhP7q1tSP1s3mjvbFhbPmAcxRDl3ajgvaV1CFXkQ3D-OsvJNrChLk5BuiQFZdrabYyfeY-soxEqnccYuci1leqxsSSf4cPBJs80o2qdDZwRrp1qgpOcQO1RFhoIfNCflIaPIQkZc6boRfCqMrSnltd0MTr2SVzcQY-sqYef3ajk96EQ_cvTZEa_fkoNns1GF8so0gAgdqGAaOC-aVPvKAMKhaYmVt1jtg7gMQtyxTZILk_4Ua4cWc7PNZIwoJVBqkKVtj9P8NXA8Q25kH_4-4nqEFrwwxMGG_KtvptdqzZuGy8alftpwcJV58yO9cdvlPM2l6sp6VjVZ2DlKzPSssF4oj1dNtXeloJ1l2w6r48ERJ-aV8QSy1KpmCMBFI4b7o1I_cX2Nw91aW0esCOkGJJbPmGVYJVDmpCtl_CuGtc27Cyy1knWfiQM_p2US6tuEw9gutNP_Q1WJGJc83fotXQzxpbF02tHEUXYjV6lTFYQbtU8KdQV0hZe_Ru_VD6bxAOUPhw85dY_zABEnXN3jAZBUDdWgtekQ_hpf6fAb24mmOmuh5UKr_eHxsqDn3o0em9ehUv1oCC4In0fDGJ0Hp5PdUyIyXHfaY-w-xOSwEc5WOkdVwi6WWtE3611unJGqf8wIy9oBeyX7JLEvU5agf9uaFw8NA",
            "refresh_token": "def50200db55915d8381950cdc523cf5638ad5f545c244d95e09b4d4692e09633f5db28096a3a5e129287c90cb9363d5ee24f63144dd9bd324f5b760cc3df59928ea65f19c41c0a9d7a7cbfc479671aedaeb685aba3db4e259f57361aa69cc0c0c7ef7f394421ca3a72453e8e76dc71bd3893039fdb1338009c2c2ec8834e0f4bfb48703cfaec9db2f28c81f83ebdda7b3c230431b2f06c6a693f4ac55f7dc752b11f591714f953d7ed103317f255b3b7bd818ab5d88d981d24630dca479641c6a4f8be5f122dfb6c7b4fa7eb9062a44b210691e685b2712f9156a7a57d65dc63f8d31cc531bdd82051555e08d4b5147888fe6b4bcc5bda5f470d27170debab97a8812c7344ed0beb13adbd34afcb431b7cfda3a53973c10009b622c65d73f7ce8d3fc8f92289b999c7eb43bc77562926e25514700d455352423225f7f81cfb84e89c5dccbb2d00affa053de754461a7efd589d957db76469365a73d18340bbb7e13b24f1b8d3117e69d89682962ac12ded46cdb1ae31af64af686964d8f6616f8a6ff812a8d4440f4d32cc859eba0590aefbc7c8b826dc09ca32f64878851b78afad89ad66c5c5bc12502b18594e56d2cb7c04077e52ec6508fffc1c115642cd1699d9d7df095edfebf882c4d6844eadbd887ee3a4ab90fabbc425e"
        }

+ Request (application/x-www-form-urlencoded)

    + Body

            email=anne%40jjjj.com&password=bbbddd

+ Response 200 (application/json)

        {
            "id": 112,
            "name": "Anne M",
            "email": "anne@jjjj.com",
            "role": "admin",
            "avatar": "jpg:data",
            "location": 2,
            "access_token": "ACCESS_TOKEN",
            "refresh_token": "REFRESH_TOKEN",
            "expires_in": 1604007710
        }

# Group Scheduling

## Appointments [/api/appointments{?location,dateMin,dateMax}]

Example: ?start=2019-01-28&end=2019-02-03
Location is optional, defaults to User location.
dateMin and dateMax must be submitted together, defaults to current week.

### Appointments for single Location [GET]

+ Parameters
    + location (optional) - The location id
    + dateMin (optional) - Start range of week YYYY-MM-DD
    + dateMax (optional) - End range of week YYYY-MM-DD

+ Response 200 (application/json)

        {
            "appointments": [
                {
                    "id": 3706,
                    "appointment": 1,
                    "date": {
                        "start": "2018-07-02T08:30:00-600",
                        "end": "2018-07-02T12:00:00-600",
                    },
                    "client": {
                        "id": 199,
                        "name": "Leroy Shelton",
                        "folder": "23088-18"
                    },
                    "ta": {
                        "id": 309,
                        "name": "Rodney Schwartz",
                        "image": "http://example.com/bio/309.jpg"
                    },
                    "room": 25
                },
                {
                    "id": 3709,
                    "appointment": 2,
                    "date": {
                        "start": "2018-07-02T13:00:00-600",
                        "end": "2018-07-02T16:30:00-600",
                    },
                    "client": {
                        "id": 199,
                        "name": "Leroy Shelton",
                        "folder": "23088-18"
                    },
                    "ta": {
                        "id": 309,
                        "name": "Rodney Schwartz",
                        "image": "http://example.com/bio/309.jpg"
                    },
                    "room": 28
                },
                {
                    "id": 3713,
                    "appointment": 3,
                    "date": {
                        "start": "2018-07-03T08:30:00-600",
                        "end": "2018-07-03T12:00:00-600",
                    },
                    "client": {
                        "id": 199,
                        "name": "Leroy Shelton",
                        "folder": "23088-18"
                    },
                    "ta": {
                        "id": 309,
                        "name": "Rodney Schwartz",
                        "image": "http://example.com/bio/309.jpg"
                    },
                    "room": 28
                },
                {
                    "id": 3719,
                    "appointment": 1,
                    "date": {
                        "start": "2018-07-03T08:30:00-600",
                        "end": "2018-07-03T12:00:00-600",
                    },
                    "client": {
                        "id": 201,
                        "name": "Melvin Doyle",
                        "folder": "23089-18"
                    },
                    "ta": {
                        "id": 211,
                        "name": "Lillie Gibson",
                        "image": "http://example.com/bio/211.jpg"
                    },
                    "room": 26
                }
            ],
            "dateMin": "2018-07-02T00:00:00-6:00",
            "dateMax": "2018-07-06T11:59:59-6:00",
            "location": {
                "id": 1,
                "name": "Denver"
            },
        }

### Create Appointment [POST]

+ Request (application/json)

        {
            "appointment": 1,
            "client": {
                "id": 201
            },
            "location": {
                "id": 1,
            },
            "date": {
                "start": "2018-07-03T08:30:00-600",
                "end": "2018-07-03T12:00:00-600",
            },

        }

+ Response 201 (application/json)

        {
            "id": 3719,
            "date": {
                "start": "2018-07-03T08:30:00-600",
                "end": "2018-07-03T12:00:00-600",
            },
        }

## Appointment [/api/appointments/{id}]

+ Parameters
    + id: 3719 (number) - Appointment ID

### Fetch Appointment [GET]

+ Response 200 (application/json)

        {
            "id": 3719,
            "appointment": 1,
            "date": {
                "start": "2018-07-03T08:30:00-600",
                "end": "2018-07-03T12:00:00-600",
            },
            "client": {
                "id": 201,
                "name": "Melvin Doyle",
                "folder": "23089-18"
            },
            "ta": {
                "id": 211,
                "name": "Lillie Gibson",
                "image": "http://example.com/bio/211.jpg"
            },
            "location": {
                "id": 1,
                "name": "Denver"
            },
            "complete": true
        }

### Edit Appointment [POST]

+ Request (application/json)

        {
            "id": 3719,
            "appointment": 1,
            "client": {
                "id": 201
            },
            "location": {
                "id": 1,
            },
            "date": {
                "start": "2018-07-04T08:30:00-600",
                "end": "2018-07-04T12:00:00-600",
            },

        }

+ Response 201 (application/json)

        {
            "id": 3719,
            "appointment": 1,
            "date": {
                "start": "2018-07-04T08:30:00-600",
                "end": "2018-07-04T12:00:00-600",
            }
        }

# Group Clients

## Client collection [/api/clients{?page,location,dateMin,dateMax}]

Example: ?start=2019-01-28&end=2019-02-03&page=2
Page is optional, defaults to 1.
Location is optional, defaults to User location.
dateMin and dateMax must be submitted together, defaults to current month.


### Fetch multiple clients [GET]

Client objects are truncated to info used on clients list page.

+ Parameters
    + page (optional) - the page of results
    + location (optional) - The location id
    + dateMin (optional) - Start range YYYY-MM-DD
    + dateMax (optional) - End range YYYY-MM-DD

+ Response 200 (application/json)

        {
            "clients": [
                {
                    "id": 199,
                    "name": "Leroy Shelton",
                    "folder": "23088-18",
                    "appointments": [
                        {
                            "id": 3706,
                            "appointment": 1,
                            "date": {
                                "start": "2018-07-02T08:30:00-600",
                                "end": "2018-07-02T12:00:00-600",
                            },
                            "complete": true
                        },
                        {
                            "id": 3709,
                            "appointment": 2,
                            "date": {
                                "start": "2018-07-02T13:00:00-600",
                                "end": "2018-07-02T16:30:00-600",
                            },
                            "complete": false
                        },
                        {
                            "id": 3713,
                            "appointment": 3,
                            "date": {
                                "start": "2018-07-03T08:30:00-600",
                                "end": "2018-07-03T12:00:00-600",
                            },
                            "complete": false
                        }
                    ],
                    "info": {
                        "complete": true
                    },
                    "payment": {
                        "amount": 700,
                        "remaining": 0,
                        "complete": true
                    }
                },
                {
                    "id": 201,
                    "name": "Melvin Doyle",
                    "folder": "23089-18",
                    "appointments": [
                        {
                            "id": 3719,
                            "appointment": 1,
                            "date": {
                                "start": "2018-07-03T08:30:00-600",
                                "end": "2018-07-03T12:00:00-600",
                            },
                            "complete": false
                        },
                    ],
                    "info": {
                        "complete": false
                    },
                    "payment": {
                        "amount": 100,
                        "remaining": 600,
                        "complete": false
                    }
                }

            ],
            "dateMin": "2018-07-02T00:00:00-6:00",
            "dateMax": "2018-07-06T11:59:59-6:00",
            "location": {
                "id": 1,
                "name": "Denver"
            },
            "links": {
                "self": "https://admin.jocrf.org/api/clients?page=3",
                "prev": "https://admin.jocrf.org/api/clients?page=2",
                "next": "https://admin.jocrf.org/api/clients?page=4",
                "first": "https://admin.jocrf.org/api/clients?page=1",
                "last": "https://admin.jocrf.org/api/clients?page=12",
            }
        }

### Create client [POST]

Post 1 - 3 "contact" objects. The first is the client.
Optional 2nd and 3rd objects are Parent / Guardian contact info.

+ Request (application/json)

        {
            "contacts": [
                {
                    "email": "test@example.com",
                    "phone": "555-555-1212",
                    "first_name": "Test",
                    "last_name": "Aten",
                },
                {
                    "email": "dad@example.com",
                    "phone": "555-555-1213",
                    "first_name": "Dad",
                    "last_name": "Aten"
                },
                {
                    "email": "mom@example.com",
                    "phone": "555-555-1214",
                    "first_name": "Mom",
                    "last_name": "Aten"
                }
            ],
            "preferred": "email"
        }

+ Response 201 (application/json)

    + Headers

            Location: /api/clients/1345

    + Body

            {
                "id": "1234"
            }

## Client [/api/clients/{id}]

+ Parameters
    + id: 199 (number) - Client ID

### Fetch Client [GET]

This should return the full client object for the detail page.

+ Response 200 (application/json)

        {
            "id": 199,
            "name": "Leroy Shelton",
            "folder": "23088-18",
            "appointments": [
                {
                    "appointment": 1,
                    "date": {
                        "start": "2018-07-02T08:30:00-600",
                        "end": "2018-07-02T12:00:00-600",
                    },
                    "location": {
                        "id": 1,
                        "name": "Denver"
                    },
                    "complete": true
                },
                {
                    "appointment": 2,
                    "date": {
                        "start": "2018-07-02T13:00:00-600",
                        "end": "2018-07-02T16:30:00-600",
                    },
                    "location": {
                        "id": 1,
                        "name": "Denver"
                    },
                    "complete": false
                },
                {
                    "appointment": 3,
                    "date": {
                        "start": "2018-07-03T08:30:00-600",
                        "end": "2018-07-03T12:00:00-600",
                    },
                    "location": {
                        "id": 1,
                        "name": "Denver"
                    },
                    "complete": false
                }
            ],
            "info": {
                "complete": true,
            },
            "personal": {
                "name": {
                    "first": "Leroy",
                    "middle": "",
                    "last": "Shelton"
                },
                "sex": "male",
                "pronouns": "He, Him",
                "birthdate": "1988-10-12",
                "preferred": "email",
                "address": "123 Anystreet",
                "city": "Denver",
                "state": "CO",
                "zip": "80202"
            },
            "contacts": [
                {
                    "email": "test@example.com",
                    "phone": "555-555-1212",
                    "first_name": "Leroy",
                    "last_name": "Shelton"
                },
                {
                    "email": "dad@example.com",
                    "phone": "555-555-1213",
                    "first_name": "Dad",
                    "last_name": "Aten"
                },
                {
                    "email": "mom@example.com",
                    "phone": "555-555-1214",
                    "first_name": "Mom",
                    "last_name": "Aten"
                }
            ],
            "education": {
                "gradeCompleted": "college-4",
                "lastSchool": "University of Pittsburgh",
                "degree": "Bachelor's of Science",
                "fieldOfStudy": "Biology",
                "likelyToChangeMajor": 3,
                "changeMajorTo": "",
                "fieldOfStudy2": "Chemistry",
                "likelyToContinueEdu": 5
            },
            "family": {
                "parents": [
                    {
                        "occupation": "Landscaper",
                        "education": "college-some"
                    },
                    {
                        "occupation": "Professor",
                        "education": "advanced"
                    }
                ],
                "twin": false,
                "triplet": false,
                "familyTested": "yes",
                "name": "Fred Shelton",
                "relationship": "Uncle",
                "yearTested": "1977"
            },
            "employment": {
                "job": {
                    "title": "Coordinating Manager",
                    "years": 4,
                    "liked": 4
                },
                "roles": [
                    {
                        "title": "Supervising",
                        "liked": 5
                    },
                    {
                        "title": "Managing",
                        "liked": 3
                    }
                ],
                "prevJobs": [
                    {
                        "title": "Coordinating Assistant",
                        "years": 2,
                        "liked": 3
                    },
                    {
                        "title": "Assistant Coordinater",
                        "years": 3,
                        "liked": 2
                    }
                ]
            },
            "interests": [
                {
                    "title": "Bike Riding",
                    "duration": "10 years"
                },
                {
                    "title": "Amateur Rocketry",
                    "duration": "5 months"
                }
            ],
            "final": {
                "referred": "familyMemberTested",
                "notes": "Uncle got tested and recommended I try it out"
            },
            "payment": {
                "amount": 750,
                "remaining": 0,
                "complete": true
            }
        }

### Edit Client [POST]

Edit client should match Create client

+ Request (application/json)

        {
            "id": 199,
            "contacts": [
                {
                    "email": "test@example.com",
                    "phone": "555-555-1212",
                    "first_name": "Test",
                    "last_name": "Aten",
                },
                {
                    "email": "dad@example.com",
                    "phone": "555-555-1213",
                    "first_name": "Dad",
                    "last_name": "Aten"
                },
                {
                    "email": "mom@example.com",
                    "phone": "555-555-1214",
                    "first_name": "Mom",
                    "last_name": "Aten"
                }
            ],
            "preferred": "email"
        }

+ Response 201 (application/json)

    + Headers

            Location: /api/clients/199

    + Body

            {
                "id": "199"
            }

## Client Payment [/api/clients/{id}/payments]

+ Parameters
    + id: 199 (number) - Client ID

### Fetch Client Payments [GET]

+ Response 200 (application/json)

        {
            "id": 199,
            "amount": 750,
            "remaining": 0,
            "complete": true,
            "payments": [
                {
                    "date": "2018-07-03T17:35:00-600,
                    "method": "8444",
                    "amount": 100
                },
                {
                    "date": "2018-07-04T08:30:00-600,
                    "method": "8444",
                    "amount": 650
                }
            ]
        }

### Add Client Payment [POST]

+ Request (application/json)

        {
            "date": "2018-07-03T17:35:00-600,
            "method": "8444",
            "amount": 100
        }

+ Response 201 (application/json)

    + Body

            {
                "id": "199"
            }

## Client Payment Methods [/api/clients/{id}/payment-methods]

+ Parameters
    + id: 199 (number) - Client ID

### Fetch Client Payment Methods [GET]

+ Response 200 (application/json)

        {
            "id": 199,
            "methods": [
                "8444",
                "5566"
            ]
        }


### Create Client Payment Methods [POST]

+ Request (application/json)

        {
            "id": 199,
            "name": {
                "first": "Leroy",
                "last": "Shelton"
            },
            "address": "123 Anystreet",
            "city": "Denver",
            "state": "CO",
            "zip": "80202"
            card: {
                number: "4444 5555 6666 7777",
                expiration: "12 / 25",
                cvc: "808"
            }
        }

+ Response 201 (application/json)

    + Body

            {
                "id": "199",
                "method": "7777"
            }


## Client Personal [/api/clients/{id}/personal]

+ Parameters
    + id: 199 (number) - Client ID

### Fetch Client Personal [GET]

+ Response 200 (application/json)

        {
            "id": 199,
            "name": {
                "first": "Leroy",
                "middle": "",
                "last": "Shelton"
            },
            "sex": "male",
            "pronouns": "He, Him",
            "birthdate": "1988-10-12",
            "preferred": "email",
            "address": "123 Anystreet",
            "city": "Denver",
            "state": "CO",
            "zip": "80202"
        }

### Create/Edit Client Personal [POST]

+ Request (application/json)

        {
            "id": 199,
            "name": {
                "first": "Leroy",
                "middle": "",
                "last": "Shelton"
            },
            "sex": "male",
            "pronouns": "He, Him",
            "birthdate": "1988-10-12",
            "preferred": "email",
            "address": "123 Anystreet",
            "city": "Denver",
            "state": "CO",
            "zip": "80202"
        }

+ Response 201 (application/json)

    + Body

            {
                "id": "199"
            }

## Client Education [/api/clients/{id}/education]

+ Parameters
    + id: 199 (number) - Client ID

### Fetch Client Education [GET]

+ Response 200 (application/json)

        {
            "id": 199,
            "gradeCompleted": "college-4",
            "lastSchool": "University of Pittsburgh",
            "degree": "Bachelor's of Science",
            "fieldOfStudy": "Biology",
            "likelyToChangeMajor": 3,
            "changeMajorTo": "",
            "fieldOfStudy2": "Chemistry",
            "likelyToContinueEdu": 5
        }

### Create/Edit Client Education [POST]

+ Request (application/json)

        {
            "id": 199,
            "gradeCompleted": "college-4",
            "lastSchool": "University of Pittsburgh",
            "degree": "Bachelor's of Science",
            "fieldOfStudy": "Biology",
            "likelyToChangeMajor": 3,
            "changeMajorTo": "",
            "fieldOfStudy2": "Chemistry",
            "likelyToContinueEdu": 5
        }

+ Response 201 (application/json)

    + Body

            {
                "id": "199"
            }

## Client Family [/api/clients/{id}/family]

+ Parameters
    + id: 199 (number) - Client ID

### Fetch Client Family [GET]

+ Response 200 (application/json)

        {
            "id": 199,
            "parents": [
                {
                    "occupation": "Landscaper",
                    "education": "college-some"
                },
                {
                    "occupation": "Professor",
                    "education": "advanced"
                }
            ],
            "twin": false,
            "triplet": false,
            "familyTested": "yes",
            "name": "Fred Shelton",
            "relationship": "Uncle",
            "yearTested": "1977"
        }

### Create/Edit Client Family [POST]

+ Request (application/json)

        {
            "id": 199,
            "parents": [
                {
                    "occupation": "Landscaper",
                    "education": "college-some"
                },
                {
                    "occupation": "Professor",
                    "education": "advanced"
                }
            ],
            "twin": false,
            "triplet": false,
            "familyTested": "yes",
            "name": "Fred Shelton",
            "relationship": "Uncle",
            "yearTested": "1977"
        }

+ Response 201 (application/json)

    + Body

            {
                "id": "199"
            }

# Group Locations

## Location collection [/api/locations]

### Fetch multiple locations [GET]

+ Response 200 (application/json)

        {
            "1": {
                "id": "1",
                "label": "Atlanta",
                "email": "atlanta@jocrf.org",
                "phone": "555-555-1212",
                "timezone": "America/New_York",
                "timezone_offset": -18000
            },
            "2": {
                "id": "2",
                "label": "Boston",
                "email": "boston@jocrf.org",
                "timezone": "America/New_York",
                "timezone_offset": -18000
            }
        }